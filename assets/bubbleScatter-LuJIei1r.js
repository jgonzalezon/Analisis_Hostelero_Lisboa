import"./index-OLMnQZqJ.js";import{o as z}from"./ordinal-C6iXb5sb.js";import{t as F,e as X,a as u,l as Y,c as H,m as A,d as j,f as E,g as _}from"./linear-UWroMf4Y.js";import{b as P,s as y,r as V}from"./init-CttvxIm1.js";function G(e,r){let n,a;if(r===void 0)for(const o of e)o!=null&&(n===void 0?o>=o&&(n=a=o):(n>o&&(n=o),a<o&&(a=o)));else{let o=-1;for(let l of e)(l=r(l,++o,e))!=null&&(n===void 0?l>=l&&(n=a=l):(n>l&&(n=l),a<l&&(a=l)))}return[n,a]}function C(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function I(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function J(e){return e<0?-e*e:e*e}function K(e){var r=e(u,u),n=1;function a(){return n===1?e(u,u):n===.5?e(I,J):e(C(n),C(1/n))}return r.exponent=function(o){return arguments.length?(n=+o,a()):n},Y(r)}function k(){var e=K(F());return e.copy=function(){return X(e,k()).exponent(e.exponent())},P.apply(e,arguments),e}function N(){return k.apply(null,arguments).exponent(.5)}function Z(e,r){if(!e)return;if(!(r!=null&&r.length)){e.textContent="Sin datos.";return}e.innerHTML="";const{width:n}=e.getBoundingClientRect(),a={top:40,right:160,bottom:50,left:60},o=n-a.left-a.right,l=n*.6-a.top-a.bottom,m=y(e).append("div").style("display","flex").style("justify-content","flex-end").style("align-items","center").style("gap","0.5rem").style("margin-bottom","0.25rem");m.append("label").text("Bucket X días:").style("font-size","0.9rem");const g=m.append("input").attr("type","range").attr("min",1).attr("max",30).attr("value",5).style("width","140px"),q=m.append("span").text("5 días").style("font-size","0.9rem").style("font-weight","600"),p=y(e).append("svg").attr("viewBox",[0,0,o+a.left+a.right,l+a.top+a.bottom]).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform",`translate(${a.left},${a.top})`),h=y("body").append("div").attr("class","tooltip").style("opacity",0),x=["City Hotel","Resort Hotel"],$={"City Hotel":"Ciudad","Resort Hotel":"Resort"},b=z().domain(x).range(["#006d77","#e63946"]);function v(i){q.text(`${i} día${i>1?"s":""}`),r.forEach(t=>{t.lead=Math.floor(+t.lead_time/i)*i});const B=V(r,t=>{const s=t.length,c=t.filter(d=>d.reservation_status==="Canceled").length;return{total:s,cancelRate:s?c/s:0}},t=>t.lead,t=>t.hotel),f=[];for(const[t,s]of B)for(const[c,d]of s)f.push({lead:t,hotel:c,total:d.total,cancelRate:d.cancelRate});const w=H().domain(G(f,t=>t.lead)).nice().range([0,o]),R=H().domain([0,A(f,t=>t.cancelRate)]).nice().range([l,0]),S=N().domain([0,A(f,t=>t.total)]).range([2,20]);p.selectAll("*").remove();const L=j(w).ticks(Math.min(10,Math.ceil(o/60))).tickFormat(t=>`${t}–${t+(i-1)}d`),T=E(R).ticks(6).tickFormat(_(".0%"));p.append("g").attr("transform",`translate(0,${l})`).call(L).append("text").attr("x",o/2).attr("y",40).attr("fill","#333").attr("text-anchor","middle").text(`Antelación (intervalos de ${i} días)`),p.append("g").call(T).append("text").attr("x",-56).attr("y",-10).attr("fill","#333").attr("text-anchor","start").text("Tasa de cancelación"),p.append("g").selectAll("circle").data(f).join("circle").attr("cx",t=>w(t.lead)).attr("cy",t=>R(t.cancelRate)).attr("r",t=>S(t.total)).attr("fill",t=>b(t.hotel)).attr("opacity",.75).on("mouseover",(t,s)=>{h.html(`
            <strong>${s.lead}–${s.lead+i-1} días</strong><br/>
            Hotel: ${$[s.hotel]}<br/>
            Tasa cancel.: ${(s.cancelRate*100).toFixed(1)}%<br/>
            Reservas: ${s.total.toLocaleString()}
          `).style("left",`${t.pageX+10}px`).style("top",`${t.pageY-28}px`).style("opacity",1)}).on("mousemove",t=>{h.style("left",`${t.pageX+10}px`).style("top",`${t.pageY-28}px`)}).on("mouseout",()=>h.style("opacity",0));const M=p.append("g").attr("transform",`translate(${o+20}, 0)`);x.forEach((t,s)=>{const c=s*24;M.append("rect").attr("x",0).attr("y",c).attr("width",16).attr("height",16).attr("fill",b(t)),M.append("text").attr("x",24).attr("y",c+12).attr("font-size","0.9rem").text($[t])})}v(+g.property("value")),g.on("input",()=>{v(+g.property("value"))})}export{Z as initBubbleScatter};
