import{d as Ce,i as In,r as ke}from"./index-OLMnQZqJ.js";import{i as pe,l as xe,a as he,b as De,c as Gn,m as nn,d as Ie}from"./linear-UWroMf4Y.js";import{s as at,i as Ge,r as Ye,a as Oe}from"./init-CttvxIm1.js";import{c as Xe}from"./colors-Cc3OSVma.js";class gt{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const i=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const a=i[r],l=n+a,c=Math.abs(n)<Math.abs(a)?n-(l-a):a-(l-n);c&&(i[e++]=c),n=l}return i[e]=n,this._n=e+1,this}valueOf(){const n=this._partials;let i=this._n,e,r,a,l=0;if(i>0){for(l=n[--i];i>0&&(e=l,r=n[--i],l=e+r,a=r-(l-e),!a););i>0&&(a<0&&n[i-1]<0||a>0&&n[i-1]>0)&&(r=a*2,e=l+r,r==e-l&&(l=e))}return l}}function*Be(t){for(const n of t)yield*n}function de(t){return Array.from(Be(t))}function Yn(t,n,i){t=+t,n=+n,i=(r=arguments.length)<2?(n=t,t=0,1):r<3?1:+i;for(var e=-1,r=Math.max(0,Math.ceil((n-t)/i))|0,a=new Array(r);++e<r;)a[e]=t+e*i;return a}function He(t,n){let i=0;if(n===void 0)for(let e of t)(e=+e)&&(i+=e);else{let e=-1;for(let r of t)(r=+n(r,++e,t))&&(i+=r)}return i}function Fe(t){let n;for(;n=t.sourceEvent;)t=n;return t}function On(t,n){if(t=Fe(t),n===void 0&&(n=t.currentTarget),n){var i=n.ownerSVGElement||n;if(i.createSVGPoint){var e=i.createSVGPoint();return e.x=t.clientX,e.y=t.clientY,e=e.matrixTransform(n.getScreenCTM().inverse()),[e.x,e.y]}if(n.getBoundingClientRect){var r=n.getBoundingClientRect();return[t.clientX-r.left-n.clientLeft,t.clientY-r.top-n.clientTop]}}return[t.pageX,t.pageY]}const gn={capture:!0,passive:!1};function vn(t){t.preventDefault(),t.stopImmediatePropagation()}function Ve(t){var n=t.document.documentElement,i=at(t).on("dragstart.drag",vn,gn);"onselectstart"in n?i.on("selectstart.drag",vn,gn):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function We(t,n){var i=t.document.documentElement,e=at(t).on("dragstart.drag",null);n&&(e.on("click.drag",vn,gn),setTimeout(function(){e.on("click.drag",null)},0)),"onselectstart"in i?e.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}const en=t=>()=>t;function qe(t,{sourceEvent:n,target:i,selection:e,mode:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},selection:{value:e,enumerable:!0,configurable:!0},mode:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function Ue(t){t.stopImmediatePropagation()}function rn(t){t.preventDefault(),t.stopImmediatePropagation()}var Xn={name:"drag"},on={name:"space"},St={name:"handle"},Et={name:"center"};const{abs:Bn,max:Q,min:j}=Math;function Hn(t){return[+t[0],+t[1]]}function Fn(t){return[Hn(t[0]),Hn(t[1])]}var Vt={name:"x",handles:["w","e"].map(mn),input:function(t,n){return t==null?null:[[+t[0],n[0][1]],[+t[1],n[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},an={},st={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Vn={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},Wn={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Ke={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Ze={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function mn(t){return{type:t}}function Je(t){return!t.ctrlKey&&!t.button}function Qe(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function je(){return navigator.maxTouchPoints||"ontouchstart"in this}function un(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function ti(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function ni(){return ei(Vt)}function ei(t){var n=Qe,i=Je,e=je,r=!0,a=Ce("start","brush","end"),l=6,c;function E(u){var v=u.property("__brush",N).selectAll(".overlay").data([mn("overlay")]);v.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",st.overlay).merge(v).each(function(){var d=un(this).extent;at(this).attr("x",d[0][0]).attr("y",d[0][1]).attr("width",d[1][0]-d[0][0]).attr("height",d[1][1]-d[0][1])}),u.selectAll(".selection").data([mn("selection")]).enter().append("rect").attr("class","selection").attr("cursor",st.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var g=u.selectAll(".handle").data(t.handles,function(d){return d.type});g.exit().remove(),g.enter().append("rect").attr("class",function(d){return"handle handle--"+d.type}).attr("cursor",function(d){return st[d.type]}),u.each(h).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(e).on("touchstart.brush",f).on("touchmove.brush",m).on("touchend.brush touchcancel.brush",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}E.move=function(u,v,g){u.tween?u.on("start.brush",function(d){o(this,arguments).beforestart().start(d)}).on("interrupt.brush end.brush",function(d){o(this,arguments).end(d)}).tween("brush",function(){var d=this,S=d.__brush,w=o(d,arguments),P=S.selection,k=t.input(typeof v=="function"?v.apply(this,arguments):v,S.extent),b=pe(P,k);function L(A){S.selection=A===1&&k===null?null:b(A),h.call(d),w.brush()}return P!==null&&k!==null?L:L(1)}):u.each(function(){var d=this,S=arguments,w=d.__brush,P=t.input(typeof v=="function"?v.apply(d,S):v,w.extent),k=o(d,S).beforestart();In(d),w.selection=P===null?null:P,h.call(d),k.start(g).brush(g).end(g)})},E.clear=function(u,v){E.move(u,null,v)};function h(){var u=at(this),v=un(this).selection;v?(u.selectAll(".selection").style("display",null).attr("x",v[0][0]).attr("y",v[0][1]).attr("width",v[1][0]-v[0][0]).attr("height",v[1][1]-v[0][1]),u.selectAll(".handle").style("display",null).attr("x",function(g){return g.type[g.type.length-1]==="e"?v[1][0]-l/2:v[0][0]-l/2}).attr("y",function(g){return g.type[0]==="s"?v[1][1]-l/2:v[0][1]-l/2}).attr("width",function(g){return g.type==="n"||g.type==="s"?v[1][0]-v[0][0]+l:l}).attr("height",function(g){return g.type==="e"||g.type==="w"?v[1][1]-v[0][1]+l:l})):u.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function o(u,v,g){var d=u.__brush.emitter;return d&&(!g||!d.clean)?d:new s(u,v,g)}function s(u,v,g){this.that=u,this.args=v,this.state=u.__brush,this.active=0,this.clean=g}s.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(u,v){return this.starting?(this.starting=!1,this.emit("start",u,v)):this.emit("brush",u),this},brush:function(u,v){return this.emit("brush",u,v),this},end:function(u,v){return--this.active===0&&(delete this.state.emitter,this.emit("end",u,v)),this},emit:function(u,v,g){var d=at(this.that).datum();a.call(u,this.that,new qe(u,{sourceEvent:v,target:E,selection:t.output(this.state.selection),mode:g,dispatch:a}),d)}};function f(u){if(c&&!u.touches||!i.apply(this,arguments))return;var v=this,g=u.target.__data__.type,d=(r&&u.metaKey?g="overlay":g)==="selection"?Xn:r&&u.altKey?Et:St,S=t===an?null:Ke[g],w=t===Vt?null:Ze[g],P=un(v),k=P.extent,b=P.selection,L=k[0][0],A,_,X=k[0][1],T,$,p=k[1][0],R,C,F=k[1][1],I,B,Y=0,M=0,D,W=S&&w&&r&&u.shiftKey,O,x,q=Array.from(u.touches||[u],z=>{const Z=z.identifier;return z=On(z,v),z.point0=z.slice(),z.identifier=Z,z});In(v);var J=o(v,arguments,!0).beforestart();if(g==="overlay"){b&&(D=!0);const z=[q[0],q[1]||q[0]];P.selection=b=[[A=t===an?L:j(z[0][0],z[1][0]),T=t===Vt?X:j(z[0][1],z[1][1])],[R=t===an?p:Q(z[0][0],z[1][0]),I=t===Vt?F:Q(z[0][1],z[1][1])]],q.length>1&&tt(u)}else A=b[0][0],T=b[0][1],R=b[1][0],I=b[1][1];_=A,$=T,C=R,B=I;var yt=at(v).attr("pointer-events","none"),dt=yt.selectAll(".overlay").attr("cursor",st[g]);if(u.touches)J.moved=Pt,J.ended=Dn;else{var It=at(u.view).on("mousemove.brush",Pt,!0).on("mouseup.brush",Dn,!0);r&&It.on("keydown.brush",Te,!0).on("keyup.brush",ze,!0),Ve(u.view)}h.call(v),J.start(u,d.name);function Pt(z){for(const Z of z.changedTouches||[z])for(const bt of q)bt.identifier===Z.identifier&&(bt.cur=On(Z,v));if(W&&!O&&!x&&q.length===1){const Z=q[0];Bn(Z.cur[0]-Z[0])>Bn(Z.cur[1]-Z[1])?x=!0:O=!0}for(const Z of q)Z.cur&&(Z[0]=Z.cur[0],Z[1]=Z.cur[1]);D=!0,rn(z),tt(z)}function tt(z){const Z=q[0],bt=Z.point0;var pt;switch(Y=Z[0]-bt[0],M=Z[1]-bt[1],d){case on:case Xn:{S&&(Y=Q(L-A,j(p-R,Y)),_=A+Y,C=R+Y),w&&(M=Q(X-T,j(F-I,M)),$=T+M,B=I+M);break}case St:{q[1]?(S&&(_=Q(L,j(p,q[0][0])),C=Q(L,j(p,q[1][0])),S=1),w&&($=Q(X,j(F,q[0][1])),B=Q(X,j(F,q[1][1])),w=1)):(S<0?(Y=Q(L-A,j(p-A,Y)),_=A+Y,C=R):S>0&&(Y=Q(L-R,j(p-R,Y)),_=A,C=R+Y),w<0?(M=Q(X-T,j(F-T,M)),$=T+M,B=I):w>0&&(M=Q(X-I,j(F-I,M)),$=T,B=I+M));break}case Et:{S&&(_=Q(L,j(p,A-Y*S)),C=Q(L,j(p,R+Y*S))),w&&($=Q(X,j(F,T-M*w)),B=Q(X,j(F,I+M*w)));break}}C<_&&(S*=-1,pt=A,A=R,R=pt,pt=_,_=C,C=pt,g in Vn&&dt.attr("cursor",st[g=Vn[g]])),B<$&&(w*=-1,pt=T,T=I,I=pt,pt=$,$=B,B=pt,g in Wn&&dt.attr("cursor",st[g=Wn[g]])),P.selection&&(b=P.selection),O&&(_=b[0][0],C=b[1][0]),x&&($=b[0][1],B=b[1][1]),(b[0][0]!==_||b[0][1]!==$||b[1][0]!==C||b[1][1]!==B)&&(P.selection=[[_,$],[C,B]],h.call(v),J.brush(z,d.name))}function Dn(z){if(Ue(z),z.touches){if(z.touches.length)return;c&&clearTimeout(c),c=setTimeout(function(){c=null},500)}else We(z.view,D),It.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);yt.attr("pointer-events","all"),dt.attr("cursor",st.overlay),P.selection&&(b=P.selection),ti(b)&&(P.selection=null,h.call(v)),J.end(z,d.name)}function Te(z){switch(z.keyCode){case 16:{W=S&&w;break}case 18:{d===St&&(S&&(R=C-Y*S,A=_+Y*S),w&&(I=B-M*w,T=$+M*w),d=Et,tt(z));break}case 32:{(d===St||d===Et)&&(S<0?R=C-Y:S>0&&(A=_-Y),w<0?I=B-M:w>0&&(T=$-M),d=on,dt.attr("cursor",st.selection),tt(z));break}default:return}rn(z)}function ze(z){switch(z.keyCode){case 16:{W&&(O=x=W=!1,tt(z));break}case 18:{d===Et&&(S<0?R=C:S>0&&(A=_),w<0?I=B:w>0&&(T=$),d=St,tt(z));break}case 32:{d===on&&(z.altKey?(S&&(R=C-Y*S,A=_+Y*S),w&&(I=B-M*w,T=$+M*w),d=Et):(S<0?R=C:S>0&&(A=_),w<0?I=B:w>0&&(T=$),d=St),dt.attr("cursor",st[g]),tt(z));break}default:return}rn(z)}}function m(u){o(this,arguments).moved(u)}function y(u){o(this,arguments).ended(u)}function N(){var u=this.__brush||{selection:null};return u.extent=Fn(n.apply(this,arguments)),u.dim=t,u}return E.extent=function(u){return arguments.length?(n=typeof u=="function"?u:en(Fn(u)),E):n},E.filter=function(u){return arguments.length?(i=typeof u=="function"?u:en(!!u),E):i},E.touchable=function(u){return arguments.length?(e=typeof u=="function"?u:en(!!u),E):e},E.handleSize=function(u){return arguments.length?(l=+u,E):l},E.keyModifiers=function(u){return arguments.length?(r=!!u,E):r},E.on=function(){var u=a.on.apply(a,arguments);return u===a?E:u},E}var H=1e-6,G=Math.PI,it=G/2,qn=G/4,ot=G*2,ct=180/G,nt=G/180,V=Math.abs,ii=Math.atan,Ct=Math.atan2,U=Math.cos,K=Math.sin,ri=Math.sign||function(t){return t>0?1:t<0?-1:0},mt=Math.sqrt;function oi(t){return t>1?0:t<-1?G:Math.acos(t)}function kt(t){return t>1?it:t<-1?-it:Math.asin(t)}function rt(){}function qt(t,n){t&&Kn.hasOwnProperty(t.type)&&Kn[t.type](t,n)}var Un={Feature:function(t,n){qt(t.geometry,n)},FeatureCollection:function(t,n){for(var i=t.features,e=-1,r=i.length;++e<r;)qt(i[e].geometry,n)}},Kn={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var i=t.coordinates,e=-1,r=i.length;++e<r;)t=i[e],n.point(t[0],t[1],t[2])},LineString:function(t,n){yn(t.coordinates,n,0)},MultiLineString:function(t,n){for(var i=t.coordinates,e=-1,r=i.length;++e<r;)yn(i[e],n,0)},Polygon:function(t,n){Zn(t.coordinates,n)},MultiPolygon:function(t,n){for(var i=t.coordinates,e=-1,r=i.length;++e<r;)Zn(i[e],n)},GeometryCollection:function(t,n){for(var i=t.geometries,e=-1,r=i.length;++e<r;)qt(i[e],n)}};function yn(t,n,i){var e=-1,r=t.length-i,a;for(n.lineStart();++e<r;)a=t[e],n.point(a[0],a[1],a[2]);n.lineEnd()}function Zn(t,n){var i=-1,e=t.length;for(n.polygonStart();++i<e;)yn(t[i],n,1);n.polygonEnd()}function wt(t,n){t&&Un.hasOwnProperty(t.type)?Un[t.type](t,n):qt(t,n)}function Sn(t){return[Ct(t[1],t[0]),kt(t[2])]}function Mt(t){var n=t[0],i=t[1],e=U(i);return[e*U(n),e*K(n),K(i)]}function Gt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Ut(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function ln(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Yt(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function En(t){var n=mt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function wn(t,n){function i(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(i.invert=function(e,r){return e=n.invert(e,r),e&&t.invert(e[0],e[1])}),i}function _n(t,n){return V(t)>G&&(t-=Math.round(t/ot)*ot),[t,n]}_n.invert=_n;function ai(t,n,i){return(t%=ot)?n||i?wn(Qn(t),jn(n,i)):Qn(t):n||i?jn(n,i):_n}function Jn(t){return function(n,i){return n+=t,V(n)>G&&(n-=Math.round(n/ot)*ot),[n,i]}}function Qn(t){var n=Jn(t);return n.invert=Jn(-t),n}function jn(t,n){var i=U(t),e=K(t),r=U(n),a=K(n);function l(c,E){var h=U(E),o=U(c)*h,s=K(c)*h,f=K(E),m=f*i+o*e;return[Ct(s*r-m*a,o*i-f*e),kt(m*r+s*a)]}return l.invert=function(c,E){var h=U(E),o=U(c)*h,s=K(c)*h,f=K(E),m=f*r-s*a;return[Ct(s*r+f*a,o*i+m*e),kt(m*i-o*e)]},l}function ui(t,n,i,e,r,a){if(i){var l=U(n),c=K(n),E=e*i;r==null?(r=n+e*ot,a=n-E/2):(r=te(l,r),a=te(l,a),(e>0?r<a:r>a)&&(r+=e*ot));for(var h,o=r;e>0?o>a:o<a;o-=E)h=Sn([l,-c*U(o),-c*K(o)]),t.point(h[0],h[1])}}function te(t,n){n=Mt(n),n[0]-=t,En(n);var i=oi(-n[1]);return((-n[2]<0?-i:i)+ot-H)%ot}function ge(){var t=[],n;return{point:function(i,e,r){n.push([i,e,r])},lineStart:function(){t.push(n=[])},lineEnd:rt,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var i=t;return t=[],n=null,i}}}function Wt(t,n){return V(t[0]-n[0])<H&&V(t[1]-n[1])<H}function Ot(t,n,i,e){this.x=t,this.z=n,this.o=i,this.e=e,this.v=!1,this.n=this.p=null}function ve(t,n,i,e,r){var a=[],l=[],c,E;if(t.forEach(function(y){if(!((N=y.length-1)<=0)){var N,u=y[0],v=y[N],g;if(Wt(u,v)){if(!u[2]&&!v[2]){for(r.lineStart(),c=0;c<N;++c)r.point((u=y[c])[0],u[1]);r.lineEnd();return}v[0]+=2*H}a.push(g=new Ot(u,y,null,!0)),l.push(g.o=new Ot(u,null,g,!1)),a.push(g=new Ot(v,y,null,!1)),l.push(g.o=new Ot(v,null,g,!0))}}),!!a.length){for(l.sort(n),ne(a),ne(l),c=0,E=l.length;c<E;++c)l[c].e=i=!i;for(var h=a[0],o,s;;){for(var f=h,m=!0;f.v;)if((f=f.n)===h)return;o=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(m)for(c=0,E=o.length;c<E;++c)r.point((s=o[c])[0],s[1]);else e(f.x,f.n.x,1,r);f=f.n}else{if(m)for(o=f.p.z,c=o.length-1;c>=0;--c)r.point((s=o[c])[0],s[1]);else e(f.x,f.p.x,-1,r);f=f.p}f=f.o,o=f.z,m=!m}while(!f.v);r.lineEnd()}}}function ne(t){if(n=t.length){for(var n,i=0,e=t[0],r;++i<n;)e.n=r=t[i],r.p=e,e=r;e.n=r=t[0],r.p=e}}function sn(t){return V(t[0])<=G?t[0]:ri(t[0])*((V(t[0])+G)%ot-G)}function li(t,n){var i=sn(n),e=n[1],r=K(e),a=[K(i),-U(i),0],l=0,c=0,E=new gt;r===1?e=it+H:r===-1&&(e=-it-H);for(var h=0,o=t.length;h<o;++h)if(f=(s=t[h]).length)for(var s,f,m=s[f-1],y=sn(m),N=m[1]/2+qn,u=K(N),v=U(N),g=0;g<f;++g,y=S,u=P,v=k,m=d){var d=s[g],S=sn(d),w=d[1]/2+qn,P=K(w),k=U(w),b=S-y,L=b>=0?1:-1,A=L*b,_=A>G,X=u*P;if(E.add(Ct(X*L*K(A),v*k+X*U(A))),l+=_?b+L*ot:b,_^y>=i^S>=i){var T=Ut(Mt(m),Mt(d));En(T);var $=Ut(a,T);En($);var p=(_^b>=0?-1:1)*kt($[2]);(e>p||e===p&&(T[0]||T[1]))&&(c+=_^b>=0?1:-1)}}return(l<-1e-6||l<H&&E<-1e-12)^c&1}function me(t,n,i,e){return function(r){var a=n(r),l=ge(),c=n(l),E=!1,h,o,s,f={point:m,lineStart:N,lineEnd:u,polygonStart:function(){f.point=v,f.lineStart=g,f.lineEnd=d,o=[],h=[]},polygonEnd:function(){f.point=m,f.lineStart=N,f.lineEnd=u,o=de(o);var S=li(h,e);o.length?(E||(r.polygonStart(),E=!0),ve(o,ci,S,i,r)):S&&(E||(r.polygonStart(),E=!0),r.lineStart(),i(null,null,1,r),r.lineEnd()),E&&(r.polygonEnd(),E=!1),o=h=null},sphere:function(){r.polygonStart(),r.lineStart(),i(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function m(S,w){t(S,w)&&r.point(S,w)}function y(S,w){a.point(S,w)}function N(){f.point=y,a.lineStart()}function u(){f.point=m,a.lineEnd()}function v(S,w){s.push([S,w]),c.point(S,w)}function g(){c.lineStart(),s=[]}function d(){v(s[0][0],s[0][1]),c.lineEnd();var S=c.clean(),w=l.result(),P,k=w.length,b,L,A;if(s.pop(),h.push(s),s=null,!!k){if(S&1){if(L=w[0],(b=L.length-1)>0){for(E||(r.polygonStart(),E=!0),r.lineStart(),P=0;P<b;++P)r.point((A=L[P])[0],A[1]);r.lineEnd()}return}k>1&&S&2&&w.push(w.pop().concat(w.shift())),o.push(w.filter(si))}}return f}}function si(t){return t.length>1}function ci(t,n){return((t=t.x)[0]<0?t[1]-it-H:it-t[1])-((n=n.x)[0]<0?n[1]-it-H:it-n[1])}const ee=me(function(){return!0},fi,hi,[-G,-it]);function fi(t){var n=NaN,i=NaN,e=NaN,r;return{lineStart:function(){t.lineStart(),r=1},point:function(a,l){var c=a>0?G:-G,E=V(a-n);V(E-G)<H?(t.point(n,i=(i+l)/2>0?it:-it),t.point(e,i),t.lineEnd(),t.lineStart(),t.point(c,i),t.point(a,i),r=0):e!==c&&E>=G&&(V(n-e)<H&&(n-=e*H),V(a-c)<H&&(a-=c*H),i=pi(n,i,a,l),t.point(e,i),t.lineEnd(),t.lineStart(),t.point(c,i),r=0),t.point(n=a,i=l),e=c},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-r}}}function pi(t,n,i,e){var r,a,l=K(t-i);return V(l)>H?ii((K(n)*(a=U(e))*K(i)-K(e)*(r=U(n))*K(t))/(r*a*l)):(n+e)/2}function hi(t,n,i,e){var r;if(t==null)r=i*it,e.point(-G,r),e.point(0,r),e.point(G,r),e.point(G,0),e.point(G,-r),e.point(0,-r),e.point(-G,-r),e.point(-G,0),e.point(-G,r);else if(V(t[0]-n[0])>H){var a=t[0]<n[0]?G:-G;r=i*a/2,e.point(-a,r),e.point(0,r),e.point(a,r)}else e.point(n[0],n[1])}function di(t){var n=U(t),i=2*nt,e=n>0,r=V(n)>H;function a(o,s,f,m){ui(m,t,i,f,o,s)}function l(o,s){return U(o)*U(s)>n}function c(o){var s,f,m,y,N;return{lineStart:function(){y=m=!1,N=1},point:function(u,v){var g=[u,v],d,S=l(u,v),w=e?S?0:h(u,v):S?h(u+(u<0?G:-G),v):0;if(!s&&(y=m=S)&&o.lineStart(),S!==m&&(d=E(s,g),(!d||Wt(s,d)||Wt(g,d))&&(g[2]=1)),S!==m)N=0,S?(o.lineStart(),d=E(g,s),o.point(d[0],d[1])):(d=E(s,g),o.point(d[0],d[1],2),o.lineEnd()),s=d;else if(r&&s&&e^S){var P;!(w&f)&&(P=E(g,s,!0))&&(N=0,e?(o.lineStart(),o.point(P[0][0],P[0][1]),o.point(P[1][0],P[1][1]),o.lineEnd()):(o.point(P[1][0],P[1][1]),o.lineEnd(),o.lineStart(),o.point(P[0][0],P[0][1],3)))}S&&(!s||!Wt(s,g))&&o.point(g[0],g[1]),s=g,m=S,f=w},lineEnd:function(){m&&o.lineEnd(),s=null},clean:function(){return N|(y&&m)<<1}}}function E(o,s,f){var m=Mt(o),y=Mt(s),N=[1,0,0],u=Ut(m,y),v=Gt(u,u),g=u[0],d=v-g*g;if(!d)return!f&&o;var S=n*v/d,w=-n*g/d,P=Ut(N,u),k=Yt(N,S),b=Yt(u,w);ln(k,b);var L=P,A=Gt(k,L),_=Gt(L,L),X=A*A-_*(Gt(k,k)-1);if(!(X<0)){var T=mt(X),$=Yt(L,(-A-T)/_);if(ln($,k),$=Sn($),!f)return $;var p=o[0],R=s[0],C=o[1],F=s[1],I;R<p&&(I=p,p=R,R=I);var B=R-p,Y=V(B-G)<H,M=Y||B<H;if(!Y&&F<C&&(I=C,C=F,F=I),M?Y?C+F>0^$[1]<(V($[0]-p)<H?C:F):C<=$[1]&&$[1]<=F:B>G^(p<=$[0]&&$[0]<=R)){var D=Yt(L,(-A+T)/_);return ln(D,k),[$,Sn(D)]}}}function h(o,s){var f=e?t:G-t,m=0;return o<-f?m|=1:o>f&&(m|=2),s<-f?m|=4:s>f&&(m|=8),m}return me(l,c,a,e?[0,-t]:[-G,t-G])}function gi(t,n,i,e,r,a){var l=t[0],c=t[1],E=n[0],h=n[1],o=0,s=1,f=E-l,m=h-c,y;if(y=i-l,!(!f&&y>0)){if(y/=f,f<0){if(y<o)return;y<s&&(s=y)}else if(f>0){if(y>s)return;y>o&&(o=y)}if(y=r-l,!(!f&&y<0)){if(y/=f,f<0){if(y>s)return;y>o&&(o=y)}else if(f>0){if(y<o)return;y<s&&(s=y)}if(y=e-c,!(!m&&y>0)){if(y/=m,m<0){if(y<o)return;y<s&&(s=y)}else if(m>0){if(y>s)return;y>o&&(o=y)}if(y=a-c,!(!m&&y<0)){if(y/=m,m<0){if(y>s)return;y>o&&(o=y)}else if(m>0){if(y<o)return;y<s&&(s=y)}return o>0&&(t[0]=l+o*f,t[1]=c+o*m),s<1&&(n[0]=l+s*f,n[1]=c+s*m),!0}}}}}var Xt=1e9,Bt=-1e9;function vi(t,n,i,e){function r(h,o){return t<=h&&h<=i&&n<=o&&o<=e}function a(h,o,s,f){var m=0,y=0;if(h==null||(m=l(h,s))!==(y=l(o,s))||E(h,o)<0^s>0)do f.point(m===0||m===3?t:i,m>1?e:n);while((m=(m+s+4)%4)!==y);else f.point(o[0],o[1])}function l(h,o){return V(h[0]-t)<H?o>0?0:3:V(h[0]-i)<H?o>0?2:1:V(h[1]-n)<H?o>0?1:0:o>0?3:2}function c(h,o){return E(h.x,o.x)}function E(h,o){var s=l(h,1),f=l(o,1);return s!==f?s-f:s===0?o[1]-h[1]:s===1?h[0]-o[0]:s===2?h[1]-o[1]:o[0]-h[0]}return function(h){var o=h,s=ge(),f,m,y,N,u,v,g,d,S,w,P,k={point:b,lineStart:X,lineEnd:T,polygonStart:A,polygonEnd:_};function b(p,R){r(p,R)&&o.point(p,R)}function L(){for(var p=0,R=0,C=m.length;R<C;++R)for(var F=m[R],I=1,B=F.length,Y=F[0],M,D,W=Y[0],O=Y[1];I<B;++I)M=W,D=O,Y=F[I],W=Y[0],O=Y[1],D<=e?O>e&&(W-M)*(e-D)>(O-D)*(t-M)&&++p:O<=e&&(W-M)*(e-D)<(O-D)*(t-M)&&--p;return p}function A(){o=s,f=[],m=[],P=!0}function _(){var p=L(),R=P&&p,C=(f=de(f)).length;(R||C)&&(h.polygonStart(),R&&(h.lineStart(),a(null,null,1,h),h.lineEnd()),C&&ve(f,c,p,a,h),h.polygonEnd()),o=h,f=m=y=null}function X(){k.point=$,m&&m.push(y=[]),w=!0,S=!1,g=d=NaN}function T(){f&&($(N,u),v&&S&&s.rejoin(),f.push(s.result())),k.point=b,S&&o.lineEnd()}function $(p,R){var C=r(p,R);if(m&&y.push([p,R]),w)N=p,u=R,v=C,w=!1,C&&(o.lineStart(),o.point(p,R));else if(C&&S)o.point(p,R);else{var F=[g=Math.max(Bt,Math.min(Xt,g)),d=Math.max(Bt,Math.min(Xt,d))],I=[p=Math.max(Bt,Math.min(Xt,p)),R=Math.max(Bt,Math.min(Xt,R))];gi(F,I,t,n,i,e)?(S||(o.lineStart(),o.point(F[0],F[1])),o.point(I[0],I[1]),C||o.lineEnd(),P=!1):C&&(o.lineStart(),o.point(p,R),P=!1)}g=p,d=R,S=C}return k}}const Mn=t=>t;var cn=new gt,Rn=new gt,ye,Se,Pn,bn,ft={point:rt,lineStart:rt,lineEnd:rt,polygonStart:function(){ft.lineStart=mi,ft.lineEnd=Si},polygonEnd:function(){ft.lineStart=ft.lineEnd=ft.point=rt,cn.add(V(Rn)),Rn=new gt},result:function(){var t=cn/2;return cn=new gt,t}};function mi(){ft.point=yi}function yi(t,n){ft.point=Ee,ye=Pn=t,Se=bn=n}function Ee(t,n){Rn.add(bn*t-Pn*n),Pn=t,bn=n}function Si(){Ee(ye,Se)}var Rt=1/0,Kt=Rt,xt=-Rt,Zt=xt,Jt={point:Ei,lineStart:rt,lineEnd:rt,polygonStart:rt,polygonEnd:rt,result:function(){var t=[[Rt,Kt],[xt,Zt]];return xt=Zt=-(Kt=Rt=1/0),t}};function Ei(t,n){t<Rt&&(Rt=t),t>xt&&(xt=t),n<Kt&&(Kt=n),n>Zt&&(Zt=n)}var An=0,$n=0,Nt=0,Qt=0,jt=0,_t=0,Nn=0,Ln=0,Lt=0,we,_e,ut,lt,et={point:vt,lineStart:ie,lineEnd:re,polygonStart:function(){et.lineStart=Mi,et.lineEnd=Ri},polygonEnd:function(){et.point=vt,et.lineStart=ie,et.lineEnd=re},result:function(){var t=Lt?[Nn/Lt,Ln/Lt]:_t?[Qt/_t,jt/_t]:Nt?[An/Nt,$n/Nt]:[NaN,NaN];return An=$n=Nt=Qt=jt=_t=Nn=Ln=Lt=0,t}};function vt(t,n){An+=t,$n+=n,++Nt}function ie(){et.point=wi}function wi(t,n){et.point=_i,vt(ut=t,lt=n)}function _i(t,n){var i=t-ut,e=n-lt,r=mt(i*i+e*e);Qt+=r*(ut+t)/2,jt+=r*(lt+n)/2,_t+=r,vt(ut=t,lt=n)}function re(){et.point=vt}function Mi(){et.point=Pi}function Ri(){Me(we,_e)}function Pi(t,n){et.point=Me,vt(we=ut=t,_e=lt=n)}function Me(t,n){var i=t-ut,e=n-lt,r=mt(i*i+e*e);Qt+=r*(ut+t)/2,jt+=r*(lt+n)/2,_t+=r,r=lt*t-ut*n,Nn+=r*(ut+t),Ln+=r*(lt+n),Lt+=r*3,vt(ut=t,lt=n)}function Re(t){this._context=t}Re.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:{this._context.moveTo(t,n),this._point=1;break}case 1:{this._context.lineTo(t,n);break}default:{this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,ot);break}}},result:rt};var Tn=new gt,fn,Pe,be,Tt,zt,Dt={point:rt,lineStart:function(){Dt.point=bi},lineEnd:function(){fn&&Ae(Pe,be),Dt.point=rt},polygonStart:function(){fn=!0},polygonEnd:function(){fn=null},result:function(){var t=+Tn;return Tn=new gt,t}};function bi(t,n){Dt.point=Ae,Pe=Tt=t,be=zt=n}function Ae(t,n){Tt-=t,zt-=n,Tn.add(mt(Tt*Tt+zt*zt)),Tt=t,zt=n}let oe,tn,ae,ue;class le{constructor(n){this._append=n==null?$e:Ai(n),this._radius=4.5,this._=""}pointRadius(n){return this._radius=+n,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(n,i){switch(this._point){case 0:{this._append`M${n},${i}`,this._point=1;break}case 1:{this._append`L${n},${i}`;break}default:{if(this._append`M${n},${i}`,this._radius!==ae||this._append!==tn){const e=this._radius,r=this._;this._="",this._append`m0,${e}a${e},${e} 0 1,1 0,${-2*e}a${e},${e} 0 1,1 0,${2*e}z`,ae=e,tn=this._append,ue=this._,this._=r}this._+=ue;break}}}result(){const n=this._;return this._="",n.length?n:null}}function $e(t){let n=1;this._+=t[0];for(const i=t.length;n<i;++n)this._+=arguments[n]+t[n]}function Ai(t){const n=Math.floor(t);if(!(n>=0))throw new RangeError(`invalid digits: ${t}`);if(n>15)return $e;if(n!==oe){const i=10**n;oe=n,tn=function(r){let a=1;this._+=r[0];for(const l=r.length;a<l;++a)this._+=Math.round(arguments[a]*i)/i+r[a]}}return tn}function $i(t,n){let i=3,e=4.5,r,a;function l(c){return c&&(typeof e=="function"&&a.pointRadius(+e.apply(this,arguments)),wt(c,r(a))),a.result()}return l.area=function(c){return wt(c,r(ft)),ft.result()},l.measure=function(c){return wt(c,r(Dt)),Dt.result()},l.bounds=function(c){return wt(c,r(Jt)),Jt.result()},l.centroid=function(c){return wt(c,r(et)),et.result()},l.projection=function(c){return arguments.length?(r=c==null?(t=null,Mn):(t=c).stream,l):t},l.context=function(c){return arguments.length?(a=c==null?(n=null,new le(i)):new Re(n=c),typeof e!="function"&&a.pointRadius(e),l):n},l.pointRadius=function(c){return arguments.length?(e=typeof c=="function"?c:(a.pointRadius(+c),+c),l):e},l.digits=function(c){if(!arguments.length)return i;if(c==null)i=null;else{const E=Math.floor(c);if(!(E>=0))throw new RangeError(`invalid digits: ${c}`);i=E}return n===null&&(a=new le(i)),l},l.projection(t).digits(i).context(n)}function kn(t){return function(n){var i=new zn;for(var e in t)i[e]=t[e];return i.stream=n,i}}function zn(){}zn.prototype={constructor:zn,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function xn(t,n,i){var e=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),e!=null&&t.clipExtent(null),wt(i,t.stream(Jt)),n(Jt.result()),e!=null&&t.clipExtent(e),t}function Ne(t,n,i){return xn(t,function(e){var r=n[1][0]-n[0][0],a=n[1][1]-n[0][1],l=Math.min(r/(e[1][0]-e[0][0]),a/(e[1][1]-e[0][1])),c=+n[0][0]+(r-l*(e[1][0]+e[0][0]))/2,E=+n[0][1]+(a-l*(e[1][1]+e[0][1]))/2;t.scale(150*l).translate([c,E])},i)}function Ni(t,n,i){return Ne(t,[[0,0],n],i)}function Li(t,n,i){return xn(t,function(e){var r=+n,a=r/(e[1][0]-e[0][0]),l=(r-a*(e[1][0]+e[0][0]))/2,c=-a*e[0][1];t.scale(150*a).translate([l,c])},i)}function Ti(t,n,i){return xn(t,function(e){var r=+n,a=r/(e[1][1]-e[0][1]),l=-a*e[0][0],c=(r-a*(e[1][1]+e[0][1]))/2;t.scale(150*a).translate([l,c])},i)}var se=16,zi=U(30*nt);function ce(t,n){return+n?ki(t,n):Ci(t)}function Ci(t){return kn({point:function(n,i){n=t(n,i),this.stream.point(n[0],n[1])}})}function ki(t,n){function i(e,r,a,l,c,E,h,o,s,f,m,y,N,u){var v=h-e,g=o-r,d=v*v+g*g;if(d>4*n&&N--){var S=l+f,w=c+m,P=E+y,k=mt(S*S+w*w+P*P),b=kt(P/=k),L=V(V(P)-1)<H||V(a-s)<H?(a+s)/2:Ct(w,S),A=t(L,b),_=A[0],X=A[1],T=_-e,$=X-r,p=g*T-v*$;(p*p/d>n||V((v*T+g*$)/d-.5)>.3||l*f+c*m+E*y<zi)&&(i(e,r,a,l,c,E,_,X,L,S/=k,w/=k,P,N,u),u.point(_,X),i(_,X,L,S,w,P,h,o,s,f,m,y,N,u))}}return function(e){var r,a,l,c,E,h,o,s,f,m,y,N,u={point:v,lineStart:g,lineEnd:S,polygonStart:function(){e.polygonStart(),u.lineStart=w},polygonEnd:function(){e.polygonEnd(),u.lineStart=g}};function v(b,L){b=t(b,L),e.point(b[0],b[1])}function g(){s=NaN,u.point=d,e.lineStart()}function d(b,L){var A=Mt([b,L]),_=t(b,L);i(s,f,o,m,y,N,s=_[0],f=_[1],o=b,m=A[0],y=A[1],N=A[2],se,e),e.point(s,f)}function S(){u.point=v,e.lineEnd()}function w(){g(),u.point=P,u.lineEnd=k}function P(b,L){d(r=b,L),a=s,l=f,c=m,E=y,h=N,u.point=d}function k(){i(s,f,o,m,y,N,a,l,r,c,E,h,se,e),u.lineEnd=S,S()}return u}}var xi=kn({point:function(t,n){this.stream.point(t*nt,n*nt)}});function Di(t){return kn({point:function(n,i){var e=t(n,i);return this.stream.point(e[0],e[1])}})}function Ii(t,n,i,e,r){function a(l,c){return l*=e,c*=r,[n+t*l,i-t*c]}return a.invert=function(l,c){return[(l-n)/t*e,(i-c)/t*r]},a}function fe(t,n,i,e,r,a){if(!a)return Ii(t,n,i,e,r);var l=U(a),c=K(a),E=l*t,h=c*t,o=l/t,s=c/t,f=(c*i-l*n)/t,m=(c*n+l*i)/t;function y(N,u){return N*=e,u*=r,[E*N-h*u+n,i-h*N-E*u]}return y.invert=function(N,u){return[e*(o*N-s*u+f),r*(m-s*N-o*u)]},y}function Gi(t){return Yi(function(){return t})()}function Yi(t){var n,i=150,e=480,r=250,a=0,l=0,c=0,E=0,h=0,o,s=0,f=1,m=1,y=null,N=ee,u=null,v,g,d,S=Mn,w=.5,P,k,b,L,A;function _(p){return b(p[0]*nt,p[1]*nt)}function X(p){return p=b.invert(p[0],p[1]),p&&[p[0]*ct,p[1]*ct]}_.stream=function(p){return L&&A===p?L:L=xi(Di(o)(N(P(S(A=p)))))},_.preclip=function(p){return arguments.length?(N=p,y=void 0,$()):N},_.postclip=function(p){return arguments.length?(S=p,u=v=g=d=null,$()):S},_.clipAngle=function(p){return arguments.length?(N=+p?di(y=p*nt):(y=null,ee),$()):y*ct},_.clipExtent=function(p){return arguments.length?(S=p==null?(u=v=g=d=null,Mn):vi(u=+p[0][0],v=+p[0][1],g=+p[1][0],d=+p[1][1]),$()):u==null?null:[[u,v],[g,d]]},_.scale=function(p){return arguments.length?(i=+p,T()):i},_.translate=function(p){return arguments.length?(e=+p[0],r=+p[1],T()):[e,r]},_.center=function(p){return arguments.length?(a=p[0]%360*nt,l=p[1]%360*nt,T()):[a*ct,l*ct]},_.rotate=function(p){return arguments.length?(c=p[0]%360*nt,E=p[1]%360*nt,h=p.length>2?p[2]%360*nt:0,T()):[c*ct,E*ct,h*ct]},_.angle=function(p){return arguments.length?(s=p%360*nt,T()):s*ct},_.reflectX=function(p){return arguments.length?(f=p?-1:1,T()):f<0},_.reflectY=function(p){return arguments.length?(m=p?-1:1,T()):m<0},_.precision=function(p){return arguments.length?(P=ce(k,w=p*p),$()):mt(w)},_.fitExtent=function(p,R){return Ne(_,p,R)},_.fitSize=function(p,R){return Ni(_,p,R)},_.fitWidth=function(p,R){return Li(_,p,R)},_.fitHeight=function(p,R){return Ti(_,p,R)};function T(){var p=fe(i,0,0,f,m,s).apply(null,n(a,l)),R=fe(i,e-p[0],r-p[1],f,m,s);return o=ai(c,E,h),k=wn(n,R),b=wn(o,k),P=ce(k,w),$()}function $(){return L=A=null,_}return function(){return n=t.apply(this,arguments),_.invert=n.invert&&X,T()}}function Le(t,n){var i=n*n,e=i*i;return[t*(.8707-.131979*i+e*(-.013791+e*(.003971*i-.001529*e))),n*(1.007226+i*(.015085+e*(-.044475+.028874*i-.005916*e)))]}Le.invert=function(t,n){var i=n,e=25,r;do{var a=i*i,l=a*a;i-=r=(i*(1.007226+a*(.015085+l*(-.044475+.028874*a-.005916*l)))-n)/(1.007226+a*(.015085*3+l*(-.044475*7+.028874*9*a-.005916*11*l)))}while(V(r)>H&&--e>0);return[t/(.8707+(a=i*i)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),i]};function Oi(){return Gi(Le).scale(175.295)}function Xi(){var t=0,n=1,i,e,r,a,l=he,c=!1,E;function h(s){return s==null||isNaN(s=+s)?E:l(r===0?.5:(s=(a(s)-i)*r,c?Math.max(0,Math.min(1,s)):s))}h.domain=function(s){return arguments.length?([t,n]=s,i=a(t=+t),e=a(n=+n),r=i===e?0:1/(e-i),h):[t,n]},h.clamp=function(s){return arguments.length?(c=!!s,h):c},h.interpolator=function(s){return arguments.length?(l=s,h):l};function o(s){return function(f){var m,y;return arguments.length?([m,y]=f,l=s(m,y),h):[l(0),l(1)]}}return h.range=o(pe),h.rangeRound=o(De),h.unknown=function(s){return arguments.length?(E=s,h):E},function(s){return a=s,i=s(t),e=s(n),r=i===e?0:1/(e-i),h}}function Bi(t,n){return n.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Cn(){var t=xe(Xi()(he));return t.copy=function(){return Bi(t,Cn())},Ge.apply(t,arguments)}const Hi=t=>ke(t[t.length-1]);var Fi=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Xe);const pn=Hi(Fi),Vi="#1e7aff",Wi=.58;let hn,dn,ht,Ht=1,Ft=365,At="total",$t=new Map;function Ji(t,n,i){t.classList.add("choropleth-layout");const e=document.createElement("div");e.className="stats-panel",e.innerHTML=`
    <div class="controls">
      <div class="year-select">
        Año: <select id="yearSel"></select>
      </div>
      <div class="metric-buttons">
        <button data-metric="total"      class="active">Visitantes</button>
        <button data-metric="revenue">Ingresos totales</button>
        <button data-metric="revenuePer">Ingresos/visita</button>
      </div>
    </div>
    <div class="top5">
      <h3>Top 5 países</h3>
      <ul id="topList"></ul>
    </div>`,t.appendChild(e);const r=document.createElement("div");r.className="choro-map",t.appendChild(r);const a=document.createElement("div");a.className="legend-wrap",t.appendChild(a);const l=document.createElement("div");l.className="timeline-wrap",t.appendChild(l),dn=new Map(n.features.map(M=>[M.id,M.properties.name])),hn=Array.from(new Set(i.map(M=>+M.arrival_date_year))).sort(),ht=hn[0];const c=e.querySelector("#yearSel"),E=e.querySelectorAll(".metric-buttons button");hn.forEach(M=>{const D=document.createElement("option");D.value=M,D.textContent=M,c.appendChild(D)}),c.value=ht;const h=r.getBoundingClientRect().width,o=h*Wi,s=at(r).append("svg").attr("viewBox",[0,0,h,o+60]).attr("preserveAspectRatio","xMidYMid meet"),f=at("body").append("div").attr("class","tooltip"),m=Oi().fitSize([h,o],n),y=$i(m),N=s.append("g").selectAll("path").data(n.features).join("path").attr("d",y).attr("fill","#eee").attr("stroke","#777").attr("stroke-width",.35);N.on("mousemove",(M,D)=>{const W=$t.get(D.id)||{total:0,resort:0,city:0,revenue:0,revenuePer:0};f.html(`
        <strong>${dn.get(D.id)??D.id}</strong><br/>
        Total visitas: ${W.total}<br/>
        Resort: ${W.resort}<br/>
        Ciudad: ${W.city}<br/>
        Ingresos: ${W.revenue.toLocaleString("es-ES",{style:"currency",currency:"EUR"})}<br/>
        €/visita: ${W.revenuePer.toFixed(2)}
      `).style("left",`${M.pageX+12}px`).style("top",`${M.pageY-28}px`).style("opacity",.95)}).on("mouseout",()=>f.style("opacity",0));const u=Cn(pn),v=Cn(pn),g=Math.min(480,h*.75),d=18,S=o+12,w=s.append("g").attr("class","map-legend").attr("transform",`translate(${(h-g)/2},${S})`);s.append("defs").append("linearGradient").attr("id","legendGrad").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%").selectAll("stop").data(Yn(0,1.01,.02)).enter().append("stop").attr("offset",M=>`${M*100}%`).attr("stop-color",M=>pn(M)),w.append("rect").attr("width",g).attr("height",d).attr("fill","url(#legendGrad)").attr("stroke","#444").attr("stroke-width",.6);const b=Gn().range([0,g]),L=w.append("g").attr("class","legend-axis").attr("transform",`translate(0,${d+6})`),A=h-80,_=14,X=at(l).append("svg").attr("width",A).attr("height",_+34),T=X.append("g").attr("transform","translate(0,20)"),$=X.append("g"),p=l.appendChild(document.createElement("div"));p.className="range-label";const R=Gn().domain([1,365]).range([0,A]),C=ni().extent([[0,20],[A,20+_]]).handleSize(8).on("end",({selection:M})=>{M&&([Ht,Ft]=M.map(D=>Math.round(R.invert(D))),B())});function F(M,D,W){const O=new Date(M,0,D),x=new Date(M,0,W),q=i.filter(J=>J.arrivalDate>=O&&J.arrivalDate<=x);return Ye(q,J=>{const yt=J.length,dt=J.filter(tt=>tt.hotel==="Resort Hotel").length,It=J.filter(tt=>tt.hotel==="City Hotel").length,Pt=He(J,tt=>tt.stays*tt.adr);return{total:yt,resort:dt,city:It,revenue:Pt,revenuePer:yt?Pt/yt:0}},J=>J.country)}function I(M){const D=Oe(i.filter(x=>+x.arrival_date_year===M),x=>x.length,x=>Math.floor((x.arrivalDate-new Date(M,0,0))/864e5)),W=Yn(1,366).map(x=>{const q=D.find(([J])=>J===x);return{day:x,val:q?q[1]:0}});v.domain([0,nn(W,x=>x.val)||1]),T.selectAll("rect").data(W).join("rect").attr("x",x=>R(x.day)).attr("width",Math.max(1,A/365)).attr("height",_).attr("fill",x=>v(x.val));const O=[{n:"Ene",d:1},{n:"Feb",d:32},{n:"Mar",d:60},{n:"Abr",d:91},{n:"May",d:121},{n:"Jun",d:152},{n:"Jul",d:182},{n:"Ago",d:213},{n:"Sep",d:244},{n:"Oct",d:274},{n:"Nov",d:305},{n:"Dic",d:335}];$.selectAll("*").remove(),$.selectAll("line").data(O).join("line").attr("x1",x=>R(x.d)).attr("x2",x=>R(x.d)).attr("y1",0).attr("y2",20+_).attr("stroke","#bbb").attr("stroke-width",.6),$.selectAll("text").data(O).join("text").attr("x",x=>R(x.d)+2).attr("y",12).attr("font-size","8px").text(x=>x.n)}function B(){$t=F(ht,Ht,Ft);const M=O=>At==="revenue"?O.revenue:At==="revenuePer"?O.revenuePer:O.total,D=Array.from($t).filter(([O])=>O!=="PRT").map(([,O])=>M(O));u.domain([0,nn(D)||1]),N.transition().duration(350).attr("fill",O=>{if(O.id==="PRT")return Vi;const x=$t.get(O.id);return x?u(M(x)):"#eee"});const W=e.querySelector("#topList");W.innerHTML="",Array.from($t).sort((O,x)=>M(x[1])-M(O[1])).slice(0,5).forEach(([O,x])=>{const q=At==="revenue"?x.revenue.toLocaleString("es-ES",{style:"currency",currency:"EUR"}):At==="revenuePer"?x.revenuePer.toFixed(2):x.total;W.insertAdjacentHTML("beforeend",`<li><span class="country">${dn.get(O)??O}</span>
               <span class="count">${q}</span></li>`)}),b.domain([0,nn(D)||1]),L.call(Ie(b).ticks(4).tickSize(3)).selectAll("text").attr("font-size","8px"),p.textContent=`${Y(ht,Ht)} → ${Y(ht,Ft)}`}c.addEventListener("change",M=>{ht=+M.target.value,Ht=1,Ft=365,I(ht),B(),X.select(".brush").call(C.move,[0,A])}),E.forEach(M=>{M.addEventListener("click",()=>{E.forEach(D=>D.classList.remove("active")),M.classList.add("active"),At=M.dataset.metric,B()})}),I(ht),B(),X.append("g").attr("class","brush").call(C).call(C.move,[0,A]);function Y(M,D){return new Date(M,0,D).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})}}export{Ji as initChoropleth};
